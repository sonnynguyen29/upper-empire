{% liquid
  assign product_name = product.title
  assign default_variant = product.selected_or_first_available_variant
  assign default_sku = default_variant.sku

  assign input_field_blocks = section.blocks | where: 'type', 'form_input_field'
%}

<pre-order-block class="product-pre-order-block">
  {{ 'product-pre-order-block.css' | asset_url | stylesheet_tag }}

  {% for variant in product.variants %}
    <span
      id="product-variant"
      data-variant-id="{{ variant.id }}"
      data-variant-sku="{{ variant.sku }}"
      data-variant-title="{{ variant.title }}"
      class="hidden"
    ></span>
  {% endfor %}

  <pre-order-layout>
    <div id="overlay"></div>

    <pre-order-container>
      <button type="button" class="form-close btn-close">
        <svg
          aria-hidden="true"
          focusable="false"
          width="12"
          height="12"
          viewBox="0 0 12 12"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path fill-rule="evenodd" clip-rule="evenodd" d="M7.41401 6.00012L11.707 1.70721C12.098 1.31622 12.098 0.684236 11.707 0.293244C11.316 -0.097748 10.684 -0.097748 10.293 0.293244L6.00001 4.58615L1.70701 0.293244C1.31601 -0.097748 0.684006 -0.097748 0.293006 0.293244C-0.0979941 0.684236 -0.0979941 1.31622 0.293006 1.70721L4.58601 6.00012L0.293006 10.293C-0.0979941 10.684 -0.0979941 11.316 0.293006 11.707C0.488006 11.902 0.744006 12 1.00001 12C1.25601 12 1.51201 11.902 1.70701 11.707L6.00001 7.4141L10.293 11.707C10.488 11.902 10.744 12 11 12C11.256 12 11.512 11.902 11.707 11.707C12.098 11.316 12.098 10.684 11.707 10.293L7.41401 6.00012Z"></path>
        </svg>
      </button>
      <div class="form">
        <div class="heading-block">
          <h2 class="heading">{{ section.settings.form_heading }}</h2>
          <span class="sub-heading">{{ section.settings.form_sub_heading }}</span>
        </div>
        <pre-order-form
          data-shopify-captcha="true"
          type="form"
          role="dialog"
          tabindex="-1"
          aria-modal="true"
          aria-label="Place your E-mail"
          data-product-name="{{ product_name }}"
          data-product-sku="{{ default_sku }}"
          data-product-handle="{{ product.handle }}"
          data-product-image="{{ product.featured_image.src | image_url: width: 200 }}"
          data-product-price="{{ product.price | money }}"
        >
          {% for field in input_field_blocks %}
            {% liquid
              assign field_name = field.settings.name
              assign field_id = 'form-field-' | append: field_name
              assign field_label_id = 'label-' | append: field_name
              assign is_required = field.settings.required
              assign is_textarea = field.settings.is_textarea
              assign error_message = field.settings.error_message
              assign field_label = field.settings.label
              assign validation = field.settings.validation
              assign placeholder = field.settings.placeholder
            %}
            <div
              id="{{ field_id }}"
              class="form-field"
              data-error-message="{{ error_message }}"
              data-validation="{{ validation }}"
              data-name="{{ field_name }}"
              data-is-required="{{ is_required }}"
            >
              {% if is_textarea == true %}
                <textarea
                  name="{{ field_name }}"
                  aria-labelledby="{{ field_label_id }}"
                  {% if is_required == true %}
                    required
                  {% endif %}
                ></textarea>
              {% else %}
                <input
                  type="text"
                  name="{{ field_name }}"
                  aria-labelledby="{{ field_label_id }}"
                  {% if is_required == true %}
                    required
                  {% endif %}
                >
              {% endif %}
              <label id="{{ field_label_id }}" for="{{ field_label_id }}">{{ placeholder }}</label>
              <span class="error-message block"></span>
            </div>
          {% endfor %}
          {% comment %}
            {% for field in input_field_blocks %}
              {% liquid
                assign field_name = field.settings.name
                assign field_id = 'form-field-' | append: field_name
                assign field_label_id = 'label-' | append: field_name
                assign is_required = field.settings.required
                assign is_textarea = field.settings.is_textarea
                assign error_message = field.settings.error_message
                assign field_label = field.settings.label
                assign validation = field.settings.validation
              %}
              <div
                id="{{ field_id }}"
                class="form-field"
                data-error-message="{{ error_message }}"
                data-validation="{{ validation }}"
              >
                <input
                  type="text"
                  name="{{ field_name }}"
                  aria-labelledby="{{ field_label_id }}"
                  {% if is_required == true %}
                    required
                  {% endif %}
                >
                <label id="{{ field_label_id }}" for="{{ field_label_id }}">{{ field_label }}</label>
                <span class="error-message block"></span>
              </div>
            {% endfor %}
          {% endcomment %}
          {% comment %}
            <div id="form-field-name" class="form-field">
              <input type="text" name="name" aria-labelledby="label-name" required>
              <label id="label-name" for="label-name">Your name*</label>
              <span class="error-message block"></span>
            </div>
            <div id="form-field-email" class="form-field">
              <input type="email" name="email" aria-labelledby="label-email" required>
              <label id="label-email" for="label-email">Your Email*</label>
              <span class="error-message block"></span>
            </div>
            <div id="form-field-phone" class="form-field">
              <input type="tel" name="phone" aria-labelledby="label-phone_number" required>
              <label id="label-phone_number" for="label-phone_number">Your Phone Number*</label>
              <span class="error-message block"></span>
            </div>
            <div id="form-field-required" class="form-field">
              <input type="text" name="required" aria-labelledby="label-required">
              <label id="label-required" for="label-required">Required</label>
              <span class="error-message block"></span>
            </div>
          {% endcomment %}

          <button class="btn-submit btn add-to-cart--secondary">
            <span class="loader"></span>
            <span class="title"> {{ section.settings.form_submit_button_text }}</span>
          </button>
          <span class="form-policy">
            {{ section.settings.form_policy_text }}
          </span>
        </pre-order-form>
      </div>

      <div class="submitted-notification success-notification hidden">
        <h3>{{ section.settings.form_success_heading }}</h3>
        <span> {{ section.settings.form_success_sub_heading }} </span>
      </div>

      <div class="submitted-notification failed-notification hidden">
        <h3>{{ section.settings.form_failed_heading }}</h3>
        <span>{{ section.settings.form_failed_sub_heading }}</span>
      </div>
    </pre-order-container>
  </pre-order-layout>
  <script src="{{ 'pre-order-block.js' | asset_url }}" defer type="text/javascript"></script>
</pre-order-block>

{% schema %}
{
  "name": "Pre-order button & form",
  "settings": [
    {
      "type": "text",
      "id": "add_to_cart_button_text",
      "label": "Submit Button Text",
      "default": "Request for Order"
    },
    {
      "type": "text",
      "id": "form_heading",
      "label": "Form Heading",
      "default": "Request for Order"
    },
    {
      "type": "text",
      "id": "form_sub_heading",
      "label": "Form Sub Heading",
      "default": "We will let you know soon once it ready."
    },
    {
      "type": "text",
      "id": "form_success_heading",
      "label": "Form Success Heading",
      "default": "Submit Success"
    },
    {
      "type": "text",
      "id": "form_success_sub_heading",
      "label": "Form Success Sub Heading",
      "default": "Thank you for your patient. The form has been submitted."
    },
    {
      "type": "text",
      "id": "form_failed_heading",
      "label": "Form Failed Heading",
      "default": "Oops !!"
    },
    {
      "type": "text",
      "id": "form_failed_sub_heading",
      "label": "Form Failed Sub Heading",
      "default": "Submission failed. Please re-enter your information and submit again."
    },
    {
      "type": "text",
      "id": "form_policy_text",
      "label": "Form Policy Text",
      "default": "By signing up, you agree to receive marketing emails. View our privacy policy and terms of service for more info."
    },
    {
      "type": "text",
      "id": "form_submit_button_text",
      "label": "Form Submit Button Text",
      "default": "Submit"
    }
  ],
  "blocks": [
    {
      "name": "Form Input Field",
      "type": "form_input_field",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Field Label",
          "default": "Your Name"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Field ID",
          "default": "name"
        },
        {
          "type": "text",
          "id": "placeholder",
          "label": "Field Placeholder",
          "default": "Your Name"
        },
        {
          "type": "checkbox",
          "id": "required",
          "label": "Required",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "is_textarea",
          "label": "Is Textarea",
          "default": false
        },
        {
          "type": "text",
          "id": "validation",
          "label": "Validation"
        },
        {
          "type": "textarea",
          "id": "error_message",
          "label": "Error Message",
          "default": "This field is required"
        }
      ]
    }
  ]
}
{% endschema %}
