{% comment %}
  Testing Cypress integration
{% endcomment %}

{% assign overlay_opacity = section.settings.overlay_opacity | divided_by: 100.0 %}
{% assign overlay_bg_color = settings['header-transparent-background'] %}
{% assign opaque_color = overlay_bg_color | color_modify: 'alpha', overlay_opacity %}
{% assign overlay = false %}
{% assign mega_menu_block = section.blocks | where: 'type', 'content' | first %}
{% assign icon_font_size = settings['typography-body-font-size'] | times: 1.5 %}

{% assign homepage-overlay = false %}
{% if section.settings.overlay_header_homepage and template == 'index' %}
  {% assign homepage-overlay = true %}
{% endif %}

{% assign collection-overlay = false %}
{% if section.settings.overlay_header_collection and template.name == 'collection' %}
  {% assign collection-overlay = true %}
{% endif %}

{% assign list-collection-overlay = false %}
{% if section.settings.overlay_header_list_collection and template == 'list-collections' %}
  {% assign list-collection-overlay = true %}
{% endif %}

{% assign contact-overlay = false %}
{% if section.settings.overlay_header_contact and template == 'page.contact' %}
  {% assign contact-overlay = true %}
{% endif %}

{% if homepage-overlay or collection-overlay or list-collection-overlay or contact-overlay %}
  {% assign overlay = true %}
{% endif %}

{% capture locale %}
  {% render 'localization-form', show_locale_selector: section.settings.show_locale_selector, show_currency_selector: section.settings.show_currency_selector %}
{% endcapture %}

{% assign menu_size = linklists[section.settings.main_linklist] | size %}
{% if menu_size == 0 %}
  {% assign site_nav = blank %}
{% else %}
  {% capture site_nav %}
    <div class="js site-header__nav top-links" id="top_links_wrapper">
      <ul class="site-nav nav-link-animated {% if mega_menu_block %} mega-menu-wrapper{% endif %}" id="AccessibleNav" role="navigation">
        {% render 'nav--main', mega_menu: mega_menu_block, logo_position: section.settings.logo-placement %}
      </ul>
    </div>
    <noscript>
      {% assign menu = linklists[section.settings.main_linklist] %}
      {% render 'noscript-menu', menu: menu %}
    </noscript>
  {% endcapture %}
{% endif %}

<noscript>
  {% assign menu = linklists[section.settings.main_linklist] %}
  {% render 'noscript-menu', menu: menu, class: 'no-js-mobile-menu' %}
</noscript>

{% style %}
  .default-menu-drawer-text-color {
    color: var(--menu-drawer-text-color);
  }

  {% if section.settings.show_locale_selector or section.settings.show_currency_selector %}
    .locale--mobile {
      padding: 15px;
    }
  {% endif %}
{% endstyle %}

<div
  class="
    header-section--wrapper
    {%- if collection-overlay or homepage-overlay or list-collection-overlay or contact-overlay %} overlay-header-wrapper{% endif -%}
    {%- if collection.image %} collection-image-enabled{% endif -%}
  "
  data-wetheme-section-type="header"
  data-wetheme-section-id="{{ section.id }}"
  data-header-sticky="{{ section.settings.sticky_header }}"
  data-header-overlay="{{ overlay }}"
>
  {% render 'menu-drawer' %}

  {% capture logo %}
    {% if section.settings.logo %}
      <a href="{{ routes.root_url }}" itemprop="url" class="site-header__logo-image">
        <style>
          .logo_image {
            max-height: unset!important;
          }
          @media screen and (max-width: 989px) {
            .logo_image {
              width: {{ section.settings.logo_max_width_mobile }}px;
            }
          }
        </style>
        {% assign alt = section.settings.logo.alt | default: shop.name %}
        {% render 'responsive-image' with section.settings.logo, alt: alt |escape, props: 'itemprop="logo"', allow_stretch: true,  blur: false, class: 'logo_image' %}
      </a>
    {% else %}
      <a class="site-header__logo-link" href="{{ routes.root_url }}" itemprop="url">{{ shop.name }}</a>
    {% endif %}
  {% endcapture %}

  {% capture overlay_logo %}
    {% if overlay %}
      {% if collection-overlay or homepage-overlay or list-collection-overlay or contact-overlay %}
        {% if section.settings.overlay_logo %}
          {% assign img = section.settings.overlay_logo %}
        {% elsif section.settings.logo %}
          {% assign img = section.settings.logo %}
        {% else %}
          {% assign img = none %}
        {% endif %}

        {% if img %}
          <a href="{{ routes.root_url }}" itemprop="url" class="site-header__logo-overlay-image">
            <style>
              .logo_overlay, 
              .logo_hover {
                max-height: unset!important;
              }
              @media screen and (max-width: 989px) {
                .logo_overlay,
                .logo_hover {
                  width: {{ section.settings.logo_max_width_mobile }}px;
                }
              }
            </style>

            <span class="opacity-logo">
              {% assign opacity_alt = img.alt | default: shop.name %}
              {% render 'responsive-image' with img, alt: opacity_alt | escape, props: 'itemprop="logo"', blur: false, class: 'logo_overlay' %}
            </span>
            {% if section.settings.overlay_logo and section.settings.logo %}
              <span class="hover-logo">
                {% assign hover_alt = section.settings.logo.alt | default: shop.name %}
                {% render 'responsive-image' with section.settings.logo, alt: hover_alt | escape, props: 'itemprop="logo"', blur: false, class: 'logo_hover' %}
              </span>
            {% endif %}
          </a>
        {% else %}
          <a class="site-header__logo-overlay-link" href="{{ routes.root_url }}" itemprop="url">{{ shop.name }}</a>
        {% endif %}
      {% endif %}
    {% endif %}
  {% endcapture %}

  {% capture header_logo_desktop %}
    <div class="site-header__logowrapper">
      {% if template == 'index' %}
        <h1 class="site-header__logo site-title" itemscope itemtype="http://schema.org/Organization">
      {% else %}
        <div class="site-header__logo h1 site-title" itemscope itemtype="http://schema.org/Organization">
      {% endif %}

        {% render 'logo-image', logo_image:section.settings.logo, className: 'logo-desktop' %}

        {{ overlay_logo }}
      {% if template == 'index' %}
        </h1>
      {% else %}
        </div>
      {% endif %}
    </div>
  {% endcapture %}

  {% capture header_logo_mobile %}
    <div class="site-header__logowrapper">
      <div class="site-header__logo h1 site-title" itemscope itemtype="http://schema.org/Organization">

        {% render 'logo-image', logo_image:section.settings.mobile_logo, className: 'logo-mobile'  %}

        {{ overlay_logo }}

      </div>
    </div>
  {% endcapture %}

  <header class="site-header {% if section.settings.sticky_header %} {% endif %}{% if section.settings.logo-placement == 'above' %} logo_above{% endif %}{% if collection-overlay or homepage-overlay or list-collection-overlay or contact-overlay %} overlay-header{% endif %}{% if section.settings.dropdown_alignment == 'center' %} dropdown-alignment--center{% endif %}{% if section.settings.overlay_logo %} overlay-logo{% endif %}">
    <div class="site-header__wrapper site-header__wrapper--logo-{{ section.settings.logo-placement }} site-header__wrapper--{% if top_links != blank %}with{% else %}without{% endif %}-menu">
      <div class="site-header__wrapper__left">
        {% if section.settings['logo-placement'] == 'left' %}
          {{ header_logo_desktop }}
        {% elsif section.settings['logo-placement'] == 'center' and site_nav != blank %}
          {{ site_nav }}
        {% else %}
          {{ locale }}
        {% endif %}
      </div>

      <div class="site-header__wrapper__center">
        {% if section.settings['logo-placement'] != 'left' %}
          {{ header_logo_desktop }}
        {% endif %}
      </div>

      <div class="site-header__wrapper__right top-links">
        {% if section.settings['logo-placement'] == 'left' %}
          {{ site_nav }}
          {{ locale }}
        {% elsif section.settings['logo-placement'] == 'center' and site_nav != blank %}
          {{ locale }}
        {% endif %}

        {% render 'header-top-links' %}
      </div>
    </div>

    {% if section.settings['logo-placement'] == 'above' and site_nav != blank %}
      <div class="site-header__nav-standalone">
        {{ site_nav }}
      </div>
    {% endif %}
  </header>

  <nav class="nav-bar mobile-nav-bar-wrapper{% if collection-overlay or homepage-overlay or list-collection-overlay or contact-overlay %} overlay-header{% endif %}">
    <div class="wrapper-padded">
      <div class="mobile-nav-bar--inner">
        <div class="mobile-grid--table">
          <div class="grid__item three-twelfths">
            <div class="site-nav--mobile">
              <button
                type="button"
                aria-label="{{ 'layout.navigation.menu' | t }}"
                class="hamburger-nav-button icon-fallback-text site-nav__link js-drawer-open-left-link"
                aria-controls="NavDrawer"
                aria-expanded="false"
              >
                {% render 'theme-icon' with icon: 'hamburger_nav' %}

                <span class="fallback-text">{{ 'layout.navigation.menu' | t }}</span>
              </button>
            </div>
          </div>

          <div class="grid__item six-twelfths">
            {{ header_logo_mobile }}
          </div>

          <div class="grid__item three-twelfths right-side{% unless section.settings.enable_search %} text-right{% else %} has-search-icon{% endunless %}">
            <div class="site-nav--mobile">
              {% if section.settings.enable_search %}
                <a
                  href="{{ routes.search_url }}"
                  class="search-button"
                  aria-label="{{ 'layout.header.search' | t }}"
                  aria-controls="SearchDrawer"
                  aria-expanded="false"
                >
                  <span class="icon-fallback-text">
                    {% render 'theme-icon' with icon: 'search', iconSize: 20 %}
                    <span class="fallback-text">{{ 'layout.header.search' | t }}</span>
                  </span>
                </a>
              {% endif %}

              <a
                href="{{ routes.cart_url }}"
                aria-label="{{ 'layout.cart.title' | t }}"
                class="{% if settings.ajax_cart_method == 'drawer' %}js-drawer-open-right-link {% endif %}site-nav__link{% if section.settings.cart_count %} cart-count-enabled {{ section.settings.cart-style }}{% endif %}"
                aria-controls="CartDrawer"
                aria-expanded="false"
              >
                {% liquid
                  assign item_count = cart.item_count
                  assign item_count = 10
                %}

                <span class="icon-fallback-text">
                  {% render 'theme-icon' with icon: section.settings.cart-style, iconClasses: 'fa-2x' %}
                  {% if section.settings.cart_count %}
                    <span class="cart-item-count-bubble cart-item-count-header cart-item-count-header--quantity{% if item_count == 0 %} hide{% endif %}">
                      {{- item_count -}}
                    </span>
                  {% endif %}
                  <span class="fallback-text">{{ 'layout.cart.title' | t }}</span>
                </span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>
</div>

<style>
  :root {
    --logo-max-width: {{ section.settings.logo_max_width | default: '450' | remove: 'px' }}px;
  }

  .site-title{
  	padding: {{ section.settings.logo_padding }}px 0;
  }

  @media screen and (max-width: 989px) {
    .site-title{
      padding: 15px 0;
    }
  }

  .site-header .site-header__wrapper .site-header__wrapper__{% if section.settings.logo-placement == 'left' %}left{% else%}center{% endif %} {
    flex-basis: {{ section.settings.logo_max_width }}px;
    {% if section.settings.logo-placement == 'left' %}
      flex-shrink: 0;
    {% endif %}
  }

  .site-header .site-header__wrapper .logo_image {
    max-width: {{ section.settings.logo_max_width }}px;
  }

  @media screen and (max-width: 989px) {
    .site-header .site-header__wrapper .logo_image {
      max-width: {{ section.settings.logo_max_width_mobile }}px;
    }
  }

  .site-nav__dropdown li, .inner .h4, .inner .h5 {
    text-align: {{ section.settings.dropdown_alignment }};
  }

  .template-index .header-section.sticky-header:not(.sticked) .overlay-header,
  .template-index .header-section:not(.sticky-header) .overlay-header,
  {% if collection-overlay %}
  .template-collection .header-section.sticky-header:not(.sticked) .overlay-header,
  .template-collection .header-section:not(.sticky-header) .overlay-header,
  {% endif %}
  .template-list-collections .header-section.sticky-header:not(.sticked) .overlay-header,
  .template-list-collections .header-section:not(.sticky-header) .overlay-header,
  .contact-page .header-section.sticky-header:not(.sticked) .overlay-header,
  .contact-page .header-section:not(.sticky-header) .overlay-header
  {
    background-color: {{ opaque_color }};
  }

  .overlay-header .grid--full {
    padding-left: 30px;
    padding-right: 30px;
  }

  @media only screen and (min-width: 768px) and (max-width: 1200px) {
    .overlay-header .grid--full {
      padding-left: 15px;
      padding-right: 15px;
    }
  }

  .template-index .overlay-header-wrapper,
  {% if collection-overlay %}.template-collection .overlay-header-wrapper, {% endif %}
  .template-list-collections .overlay-header-wrapper,
  .contact-page .overlay-header-wrapper
  {
    max-height: 0px !important;
    min-height: 0px !important;
  }

  .template-index .overlay-header.force-hover,
  {% if collection-overlay %}.template-collection .overlay-header.force-hover, {% endif %}
  .template-list-collections .overlay-header.force-hover
  .contact-page .overlay-header.force-hover
   {
    background-color: {{ settings.header-bg-color }};
  }

  {% if section.settings.overlay_logo != blank and section.settings.logo == blank %}
    @media only screen and (min-width: 768px) {
      .template-index .overlay-header.ui.sticky:not(.top) .site-header__logo-link {
          display: none;
      }
      .template-index .header-section.sticky-header:not(.sticked) .overlay-header.force-hover .site-header__logo-link,
      .template-index .header-section.sticky-header:not(.sticked) .overlay-header:hover .site-header__logo-link,
      .template-collection .header-section.sticky-header:not(.sticked) .overlay-header.force-hover .site-header__logo-link,
      .template-collection .header-section.sticky-header:not(.sticked) .overlay-header:hover .site-header__logo-link,
      .template-list-collections .header-section.sticky-header:not(.sticked) .overlay-header.force-hover .site-header__logo-link,
      .template-list-collections .header-section.sticky-header:not(.sticked) .overlay-header:hover .site-header__logo-link,
      .contact-page .header-section.sticky-header:not(.sticked) .overlay-header.force-hover .site-header__logo-link,
      .contact-page .ui.sticky:not(.top) .overlay-header:hover .site-header__logo-link
      {
        display: block;
      }
    }
  {% endif %}
</style>

{% schema %}
{
  "name": "t:sections.header.name",
  "class": "header-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "sticky_header",
      "label": "t:sections.header.settings.sticky_header.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_search",
      "label": "t:sections.header.settings.enable_search.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:all.Logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "t:all.Logo_image"
    },
    {
      "type": "image_picker",
      "id": "mobile_logo",
      "label": "Mobile logo"
    },
    {
      "type": "select",
      "id": "logo-placement",
      "label": "t:sections.header.settings.logo-placement.label",
      "default": "left",
      "options": [
        {
          "value": "left",
          "label": "t:all.Left"
        },
        {
          "value": "center",
          "label": "t:all.Center"
        },
        {
          "value": "above",
          "label": "t:sections.header.settings.logo-placement.options.above"
        }
      ]
    },
    {
      "type": "range",
      "id": "logo_max_width",
      "min": 50,
      "max": 500,
      "step": 5,
      "unit": "t:all.px",
      "label": "t:all.Logo_width_on_desktop",
      "default": 125
    },
    {
      "type": "range",
      "id": "logo_max_width_mobile",
      "min": 20,
      "max": 100,
      "step": 1,
      "unit": "t:all.px",
      "label": "t:all.Logo_width_on_mobile",
      "info": "t:sections.header.settings.logo_max_width_mobile.info",
      "default": 24
    },
    {
      "type": "range",
      "id": "logo_padding",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "t:all.px",
      "label": "t:sections.header.settings.logo_padding.label",
      "default": 10
    },
    {
      "type": "header",
      "content": "t:all.Mobile_navigation"
    },
    {
      "type": "checkbox",
      "id": "mobile_social_icons",
      "label": "t:all.Show_social_media_icons",
      "info": "t:all.To_choose_which_icons_to_display_go_to_Theme_settings__Social_media_",
      "default": false
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header-10.content"
    },
    {
      "type": "checkbox",
      "id": "show_icons",
      "label": "t:sections.header.settings.show_icons.label",
      "default": true,
      "info": "t:sections.header.settings.show_icons.info"
    },
    {
      "type": "radio",
      "id": "cart-style",
      "label": "t:sections.header.settings.cart-style.label",
      "options": [
        {
          "value": "shopping-bag",
          "label": "t:sections.header.settings.cart-style.options.shopping_bag"
        },
        {
          "value": "shopping-cart",
          "label": "t:sections.header.settings.cart-style.options.shopping_cart"
        }
      ],
      "default": "shopping-cart"
    },
    {
      "type": "checkbox",
      "id": "cart_count",
      "label": "t:sections.header.settings.cart_count.label",
      "default": true
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header-14.content"
    },
    {
      "type": "checkbox",
      "id": "overlay_header_homepage",
      "label": "t:sections.header.settings.overlay_header_homepage.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "overlay_header_collection",
      "label": "t:sections.header.settings.overlay_header_collection.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "overlay_header_list_collection",
      "label": "t:sections.header.settings.overlay_header_list_collection.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "overlay_header_contact",
      "label": "t:sections.header.settings.overlay_header_contact.label",
      "default": false
    },
    {
      "type": "image_picker",
      "id": "overlay_logo",
      "label": "t:sections.header.settings.overlay_logo.label"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 1,
      "label": "t:sections.header.settings.overlay_opacity.label",
      "default": 0,
      "unit": "t:all.percentage",
      "info": "t:sections.header.settings.overlay_opacity.info"
    },
    {
      "type": "header",
      "content": "t:all.Country_region_selector",
      "info": "t:all.To_add_a_country_region_go_to_your_market_settings__admin_settings_markets"
    },
    {
      "type": "checkbox",
      "id": "show_currency_selector",
      "label": "t:all.Enable_country_region_selector",
      "default": true
    },
    {
      "type": "header",
      "content": "t:all.Language_selector",
      "info": "t:all.To_add_a_language_go_to_your_language_settings__admin_settings_languages"
    },
    {
      "type": "checkbox",
      "id": "show_locale_selector",
      "label": "t:all.Enable_language_selector",
      "default": true
    },
    {
      "type": "header",
      "content": "t:all.Navigation"
    },
    {
      "type": "link_list",
      "id": "main_linklist",
      "label": "t:sections.header.settings.main_linklist.label",
      "default": "main-menu"
    },
    {
      "type": "select",
      "id": "dropdown_alignment",
      "label": "t:sections.header.settings.dropdown_alignment.label",
      "default": "left",
      "options": [
        {
          "value": "left",
          "label": "t:all.Left"
        },
        {
          "value": "center",
          "label": "t:all.Center"
        },
        {
          "value": "right",
          "label": "t:all.Right"
        }
      ]
    }
  ],
  "blocks": [
    {
      "type": "content",
      "name": "t:sections.header.blocks.content.name",
      "settings": [
        {
          "id": "mega-menu",
          "type": "text",
          "label": "t:all.Menu_item",
          "info": "t:sections.header.blocks.content.settings.mega-menu.info"
        },
        {
          "type": "header",
          "content": "t:sections.header.blocks.content.settings.header-1.content"
        },
        {
          "type": "image_picker",
          "id": "mega_image_1",
          "label": "t:all.Image"
        },
        {
          "type": "select",
          "id": "image_1_aspect_ratio",
          "label": "t:all.Image_aspect_ratio",
          "default": "square",
          "options": [
            {
              "value": "natural",
              "label": "t:all.Natural"
            },
            {
              "value": "square",
              "label": "t:all.Square_1_1"
            },
            {
              "value": "tall",
              "label": "t:all.Tall_2_3"
            },
            {
              "value": "wide",
              "label": "t:all.Wide_4_3"
            }
          ]
        },
        {
          "type": "text",
          "id": "mega_image_header_1",
          "label": "t:all.Heading"
        },
        {
          "type": "text",
          "id": "mega_image_subheader_1",
          "label": "t:all.Subheading"
        },
        {
          "type": "checkbox",
          "id": "overlay_text_on_image_promo_1",
          "label": "t:all.Overlay_text_on_image",
          "default": true
        },
        {
          "type": "color",
          "id": "overlay_text_color_promo_1",
          "label": "t:all.Overlay_text_color",
          "default": "#FFFFFF"
        },
        {
          "type": "url",
          "id": "mega_image_link_1",
          "label": "t:all.Link"
        },
        {
          "type": "checkbox",
          "id": "show_promo_1_in_mobile_drawer",
          "label": "t:all.Show_in_mobile_drawer",
          "default": true
        },
        {
          "type": "header",
          "content": "t:sections.header.blocks.content.settings.header-10.content"
        },
        {
          "type": "image_picker",
          "id": "mega_image_2",
          "label": "t:all.Image"
        },
        {
          "type": "select",
          "id": "image_2_aspect_ratio",
          "label": "t:all.Image_aspect_ratio",
          "default": "square",
          "options": [
            {
              "value": "natural",
              "label": "t:all.Natural"
            },
            {
              "value": "square",
              "label": "t:all.Square_1_1"
            },
            {
              "value": "tall",
              "label": "t:all.Tall_2_3"
            },
            {
              "value": "wide",
              "label": "t:all.Wide_4_3"
            }
          ]
        },
        {
          "type": "text",
          "id": "mega_image_header_2",
          "label": "t:all.Heading"
        },
        {
          "type": "text",
          "id": "mega_image_subheader_2",
          "label": "t:all.Subheading"
        },
        {
          "type": "checkbox",
          "id": "overlay_text_on_image_promo_2",
          "label": "t:all.Overlay_text_on_image",
          "default": true
        },
        {
          "type": "color",
          "id": "overlay_text_color_promo_2",
          "label": "t:all.Overlay_text_color",
          "default": "#FFFFFF"
        },
        {
          "type": "url",
          "id": "mega_image_link_2",
          "label": "t:all.Link"
        },
        {
          "type": "checkbox",
          "id": "show_promo_2_in_mobile_drawer",
          "label": "t:all.Show_in_mobile_drawer",
          "default": true
        }
      ]
    }
  ]
}
{% endschema %}
