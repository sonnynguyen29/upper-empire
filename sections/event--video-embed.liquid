{{ 'event--video-embed.css' | asset_url | stylesheet_tag }}

{% schema %}
{
  "name": "Event Video Embed",
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Video Collections"
    }
  ],
  "blocks": [
    {
      "type": "video",
      "name": "Video",
      "settings": [
        {
          "type": "textarea",
          "id": "youtube_link",
          "label": "YouTube Video Links"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Event Video Embed",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<section class="event-video-embed-section">
  <h2>
    {{ section.settings.section_title }}
  </h2>
  {% liquid
    assign youtube_links = section.blocks | where: 'type', 'video'
  %}
  <div class="video-embed-grid">
    <div class="video-embed-container">
      {% for youtube_link in youtube_links %}
        {% liquid
          assign youtube_link_settings = youtube_link.settings.youtube_link
          assign video_id = youtube_link_settings | strip | split: 'v=' | last
        %}
        <div
          class="video-embed-grid__video"
          data-video-position="{{ forloop.index0 }}"
          data-video-id={{ video_id }}
          style="{% if forloop.index == 1 %}display: block;{% else %}display: none;{% endif %}"
        >
          {% comment %} <iframe
            width="560"
            height="315"
            src="https://www.youtube.com/embed/{{ video_id }}?controls=0&modestbranding=1&showinfo=0&rel=0"
            frameborder="0"
            allow="autoplay; encrypted-media"
            allowfullscreen
          ></iframe> {% endcomment %}
        </div>
      {% endfor %}
    </div>
    <div class="video-embed-grid__thumbnail_grid video-embed__splide splide" data-size="{{ youtube_links.size }}">
      <div class="splide__track">
        <div class="splide__list">
          {% for youtube_link in youtube_links %}
            {% liquid
              assign youtube_link_settings = youtube_link.settings.youtube_link
              assign video_id = youtube_link_settings | strip | split: 'v=' | last
            %}
            <div
              class="video-embed-grid__thumbnail_grid__thumbnail splide__slide{% if forloop.index0 == 0 %} video-embed-grid__thumbnail_grid__thumbnail--active{% endif %}"
              data-video-position="{{ forloop.index0 }}"
            >
              <img
                src="https://img.youtube.com/vi/{{ video_id }}/maxresdefault.jpg"
                alt="Thumbnail"
                width="600"
                height="400"
              >
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

<script src="{{ 'event--video-embed.js' | asset_url }}" defer></script>

<style>
  .video-embed-section {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
  }
  .video-embed {
    flex: 1 1 45%;
    max-width: 45%;
  }
  .video-embed iframe {
    width: 100%;
    height: 315px;
  }
</style>
